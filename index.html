<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mini Secr√©tariat Complet</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<style>
:root{--bg1:#ffefd5;--bg2:#ffe4f0;--accent:#ff6b6b;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Inter,sans-serif;background:linear-gradient(120deg,var(--bg1),var(--bg2));color:#222;overflow-x:hidden;}
.header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:rgba(255,255,255,0.6);backdrop-filter:blur(6px);box-shadow:0 6px 18px rgba(0,0,0,0.06);position:sticky;top:0;z-index:10;}
.brand{display:flex;align-items:center;gap:12px;}
.brand .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(45deg,#ff9a9e,#fad0c4);display:flex;align-items:center;justify-content:center;font-size:28px;}
.brand h1{font-family:Dancing Script,cursive;margin:0;font-size:20px;color:var(--accent);}
.container{padding:8px;display:flex;justify-content:center;flex-direction:column;align-items:center;}
.main{background:rgba(255,255,255,0.9);padding:8mm;border-radius:12px;width:95%;max-width:600px;min-height:105mm;overflow-y:auto;-webkit-overflow-scrolling:touch;position:relative;font-size:12px;line-height:1.4;word-wrap: break-word;}
.doc-title{font-family:Dancing Script,cursive;font-size:18px;margin:6px 0;}
.handwritten{font-family:'Dancing Script',cursive;font-weight:700;font-size:16px;color:#2c3e50;}
.doc-photo{width:60px;height:60px;object-fit:cover;border-radius:50%;border:2px solid white;box-shadow:0 4px 12px rgba(0,0,0,0.08);cursor:pointer;margin:4px;float:left;}
.btn{padding:6px 10px;border-radius:8px;border:0;cursor:pointer;margin-top:4px;font-size:12px;}
.btn-primary{background:linear-gradient(90deg,#4facfe,#00f2fe);color:white;}
.btn-ghost{background:transparent;border:1px solid #ddd;margin-left:6px;font-size:12px;}
.signature-pad{border:1px solid #ccc;border-radius:8px;width:100%;height:50px;background:#fff;margin-top:8px;}
input.editable{font-weight:bold;font-size:14px;text-align:center;margin-bottom:8px;}
.photo-flottante{float:left;margin:4px;padding:4px;border:1px solid #aaa;border-radius:6px;background:#fff;max-width:200px;display:inline-block;}
.photo-flottante img{max-width:100%;display:block;margin-bottom:4px;}
.photo-flottante div{word-wrap:break-word;}
.fiche70{display:flex; flex-wrap:wrap; gap:12px;}
.colonne{flex:1; min-width:45%;}
textarea, input{font-family:Inter,sans-serif;}
/* Hamburger et menu */
.hamburger { width: 35px; cursor: pointer; display: flex; flex-direction: column; gap: 6px; margin: 15px; z-index: 1001; position: relative; }
.hamburger div { height: 4px; background: #000; border-radius: 3px; transition: .3s; }
.side-menu { position: fixed; top: 0; right: -250px; width: 250px; height: 100%; background: #fff; padding-top: 80px; display: flex; flex-direction: column; gap: 15px; transition: right .4s ease; box-shadow: -4px 0 10px rgba(0,0,0,0.1); z-index: 1000; overflow-y:auto; }
.side-menu a { font-size: 16px; padding: 8px 16px; color: #000; text-decoration: none; }
.side-menu a:hover { background: #f5f5f5; }
.side-menu.open { right: 0; }
.hamburger.active div:nth-child(1) { transform: translateY(10px) rotate(45deg); }
.hamburger.active div:nth-child(2) { opacity: 0; }
.hamburger.active div:nth-child(3) { transform: translateY(-10px) rotate(-45deg); }
/* Popup paiement */
#paymentModal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:1000;}
#paymentModal > div{background:white;border-radius:12px;padding:18px;max-width:400px;width:100%;}
#pmMsg{margin-top:8px;color:crimson;}
</style>
</head>
<body>
<header class="header">
  <div class="brand">
    <div class="logo">LF</div>
    <h1>Mini Secr√©tariat</h1>
  </div>
  <div class="hamburger" id="hamburger">
    <div></div><div></div><div></div>
  </div>
</header>

<div class="side-menu" id="sideMenu">
  <a href="#" onclick="ouvrirDoc('CV'); closeMenu(); return false;">CV</a>
  <a href="#" onclick="ouvrirDoc('CarteVisite'); closeMenu(); return false;">Carte Visite</a>
  <a href="#" onclick="ouvrirDoc('LettreMotivation'); closeMenu(); return false;">Lettre Motivation</a>
  <a href="#" onclick="ouvrirDoc('CNI'); closeMenu(); return false;">CNI</a>
  <a href="#" onclick="ouvrirDoc('ProtocoleAccord'); closeMenu(); return false;">Protocole Accord</a>
  <a href="#" onclick="ouvrirDoc('ContratTravail'); closeMenu(); return false;">Contrat Travail</a>
  <a href="#" onclick="ouvrirDoc('PlanLocalisation'); closeMenu(); return false;">Plan Localisation</a>
  <a href="#" onclick="ouvrirDoc('Fiche70Noms'); closeMenu(); return false;">Fiche 70 Noms</a>
  <a href="#" onclick="ouvrirDoc('Rapport'); closeMenu(); return false;">Rapport</a>
  <a href="#" onclick="ouvrirDoc('GaleriePhotos'); closeMenu(); return false;">Galerie Photos</a>
  <a href="https://module-paiement.vercel.app" target="_blank">Calendrier personnalis√©</a>
  <a href="https://secr-taire.vercel.app"_blank">calendrier sportifs</a>
  <a
<a href="https://devislesfacilitateurs.vercel.app/"_blank">devis estimatif</a>
  <a
<a href="https://api-lime-nine-94.vercel.app/"_blank">programme inhumation</a>
  <a href="https://lesfacilitateurs.vercel.app" target="_blank">retour √† l'accueil accueil</a>
</div>

<div class="container">
  <main class="main" id="app">
    <p>Bienvenue dans le Mini Secr√©tariat. Choisissez un document pour commencer ‚ú®</p>
  </main>
</div>

<!-- Popup paiement -->
<div id="paymentModal">
  <div>
    <h3>Paiement requis</h3>
    <div><strong>B√©n√©ficiaire :</strong> kono emini Michel</div>
    <div><strong>MOMO :</strong> 651475255</div>
    <div><strong>OM :</strong> 656050097</div>
    <div style="margin-top:8px">
      <label>Message Mobile Money</label>
      <input id="mmMsg" type="text" placeholder="Copiez le message re√ßu" style="font-size:13px"/>
    </div>
    <div style="margin-top:8px">
      <label>Code Admin / VIP</label>
      <input id="vipInput" type="text" placeholder="Entrez votre code" style="font-size:13px"/>
    </div>
    <button class="btn btn-primary" style="width:100%;margin-top:8px" onclick="verifierPaiementStrict()">Valider</button>
    <button class="btn btn-ghost" onclick="fermerPopup()">Annuler</button>
    <p id="pmMsg"></p>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.4/dist/signature_pad.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
const documents=['CV','CarteVisite','LettreMotivation','CNI','ProtocoleAccord','ContratTravail','PlanLocalisation','Fiche70Noms','Rapport','GaleriePhotos'];
const VIP_CODE='233233';
let paiementValide=false;
let nomSignataire='Nom Signataire';
const noms=Array.from({length:70},(_,i)=>'Nom '+(i+1));

const hamburger = document.getElementById('hamburger');
const sideMenu = document.getElementById('sideMenu');
hamburger.addEventListener('click', ()=> { hamburger.classList.toggle('active'); sideMenu.classList.toggle('open'); });
function closeMenu(){ hamburger.classList.remove('active'); sideMenu.classList.remove('open'); }

// --- Paiement strict ---
function ouvrirPopup(){document.getElementById('paymentModal').style.display='flex'; document.getElementById('pmMsg').textContent='';}
function fermerPopup(){document.getElementById('paymentModal').style.display='none';}
function verifierPaiementStrict() {
  const msg = document.getElementById('mmMsg').value.trim();
  const vip = document.getElementById('vipInput').value.trim();
  const pmMsg = document.getElementById('pmMsg');
  pmMsg.textContent = '';

  let valide = false;

  // üî• V√©rification du code admin VIP (fonctionne maintenant √† 100%)
  if (vip === VIP_CODE) {
    paiementValide = true;
    fermerPopup();
    alert("Code admin valid√© ‚úÖ");
    return;
  }

  // --- V√©rification message HelepMoney (d√©pot Mobile Money)
  const regexInfo = /kono\s+emini|Michel|651475255|656050097/i;
  const regexMontant = /\b100\s?(F|FCFA|XAF)\b/i;            // montant obligatoire 100 FCFA
  const regexId = /(ID|TID|Ref)\s?[A-Za-z0-9]+/i;           // identifiant obligatoire
  const regexDate = /\d{2}[:h]\d{2}/;                       // heure obligatoire (08:25 ou 08h25)

  if (
    regexInfo.test(msg) &&
    regexMontant.test(msg) &&
    regexId.test(msg) &&
    regexDate.test(msg)
  ) {
    paiementValide = true;
    fermerPopup();
    alert("Paiement valid√© automatiquement ‚úî");
    return;
  }

  // Si aucun des deux n'est valid√©
  pmMsg.textContent =
    "Message ou code invalide ‚ùå. V√©rifiez le nom, le num√©ro, le montant (100 FCFA), l‚ÄôID et l‚Äôheure.";
  paiementValide = false;
}

// --- Documents ---
function ouvrirDoc(doc){
  const app=document.getElementById('app');
  const photoHTML=(id,title)=>`<input type="file" id="${id}" accept="image/*" style="display:none" onchange="afficherPhoto('${id}','img${id}')"/><label for="${id}"><img id="img${id}" class="doc-photo" title="${title}" src=""/></label>`;
  
  let content='';
  if(doc==='CNI'){ content=`<div style="margin-bottom:12px;border:1px solid #000;padding:4px;"><input type="file" id="CNIrecto" accept="image/*" style="display:none" onchange="afficherPhoto('CNIrecto','imgCNIrecto')"/><label for="CNIrecto"><img id="imgCNIrecto" style="width:100%; height:50mm; object-fit:cover; display:block;" src=""/></label></div><div style="margin-bottom:12px;border:1px solid #000;padding:4px;"><input type="file" id="CNIverso" accept="image/*" style="display:none" onchange="afficherPhoto('CNIverso','imgCNIverso')"/><label for="CNIverso"><img id="imgCNIverso" style="width:100%; height:50mm; object-fit:cover; display:block;" src=""/></label></div>`;}
  else if(doc==='Fiche70Noms'){ content='<div class="fiche70"><div class="colonne">'+noms.slice(0,35).map(n=>`<input value="${n}" style="width:100%;margin-bottom:2px"/>`).join('')+'</div><div class="colonne">'+noms.slice(35).map(n=>`<input value="${n}" style="width:100%;margin-bottom:2px"/>`).join('')+'</div></div>'; }
  else if(doc==='GaleriePhotos'){ content=`<div id="galleryContainer"></div><button class="btn btn-ghost" onclick="ajouterPhotoFlottante()">‚ûï Ajouter photo</button>`;}
  else if(doc==='ProtocoleAccord'){ content=`<textarea style="width:100%; min-height:150px;">Contenu du protocole...</textarea><div id="signatairesContainer" style="margin-top:12px;"><h4>Signataires :</h4><div><input placeholder="Nom signataire 1" style="width:100%; margin-bottom:4px;"/></div></div><button class="btn btn-ghost" onclick="ajouterSignataire()">‚ûï Ajouter signataire</button>`;}
  else{ content=`${photoHTML(doc+'Photo',doc)}<textarea>Votre contenu...</textarea>`; }

  content+=`<canvas id="signaturePad" class="signature-pad"></canvas><input class="editable" id="signataireInput" placeholder="Nom signataire"/><button class="btn btn-ghost" onclick="clearSignature()">Effacer signature</button><button class="btn btn-primary" onclick="exportPDF('${doc}')">üìÑ T√©l√©charger PDF</button><button class="btn btn-ghost" onclick="app.innerHTML='<p>Bienvenue dans le Mini Secr√©tariat...</p>'">Retour</button>`;

  app.innerHTML=`<h2 class="doc-title handwritten">${doc.replace(/([A-Z])/g," $1").trim()}</h2>`+content;

  const canvas=document.getElementById('signaturePad');
  window.signaturePad=new SignaturePad(canvas);

  const signInput=document.getElementById('signataireInput');
  signInput.value=nomSignataire;
  signInput.addEventListener('input',()=>{nomSignataire=signInput.value;});

  document.querySelectorAll('textarea').forEach(t=>{t.addEventListener('input',()=>{t.style.height='auto';t.style.height=t.scrollHeight+'px';});});
}

// --- Fonctions auxiliaires ---
function ajouterSignataire(){const container=document.getElementById('signatairesContainer');const count=container.querySelectorAll('input').length+1;const div=document.createElement('div');div.innerHTML=`<input placeholder="Nom signataire ${count}" style="width:100%; margin-bottom:4px;"/>`;container.appendChild(div);}
function afficherPhoto(inputId,imgId){const input=document.getElementById(inputId);const img=document.getElementById(imgId);if(input.files && input.files[0]){const reader=new FileReader();reader.onload=function(e){img.src=e.target.result;};reader.readAsDataURL(input.files[0]);}}
function ajouterPhotoFlottante(){const container=document.getElementById('galleryContainer');const id='photo'+Date.now();const div=document.createElement('div');div.className='photo-flottante';div.innerHTML=`<input type="file" accept="image/*" onchange="chargerImageFlottante(event,'${id}')"><img id="img${id}" src=""/><div contenteditable="true">Commentaire...</div>`;container.appendChild(div);}
function chargerImageFlottante(e,id){const img=document.getElementById('img'+id);const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=function(ev){img.src=ev.target.result;};reader.readAsDataURL(file);}}
function clearSignature(){window.signaturePad.clear();}

// --- Export PDF avec paiement ---
async function exportPDF(docName){
  if(!paiementValide){ouvrirPopup(); return;}
  const app=document.getElementById('app');
  const clone=app.cloneNode(true);
  clone.style.background="#ffffff"; clone.style.padding="10px"; clone.style.width="100%"; clone.style.maxWidth="480px"; clone.style.position="static"; clone.style.overflow="visible";
  clone.querySelectorAll("*").forEach(el=>{ el.style.overflow="visible"; el.style.background=(el.style.background||"").includes("linear-gradient")?"#ffffff":el.style.background; el.style.backdropFilter="none"; el.style.position=el.style.position==="relative"?"static":el.style.position;});
  clone.querySelectorAll('textarea,input,[contenteditable]').forEach(f=>{const d=document.createElement('div'); d.textContent=f.value||f.textContent; d.style.cssText=`font-size:12px; margin-bottom:4px; white-space:pre-wrap;`; f.replaceWith(d);});
  clone.querySelectorAll('canvas').forEach(c=>{const img=document.createElement('img'); img.src=c.toDataURL("image/png"); img.style.maxWidth="100%"; c.replaceWith(img);});
  const temp=document.createElement("div"); temp.style.position="absolute"; temp.style.left="-9999px"; document.body.appendChild(temp); temp.appendChild(clone);
  await Promise.all([...clone.querySelectorAll("img")].map(img=>new Promise(res=>{ if(img.complete) res(); else img.onload=img.onerror=res; })));
  const canvas=await html2canvas(clone,{scale:2,backgroundColor:"#ffffff",useCORS:true,scrollX:0,scrollY:0});
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a6");

  const pw = pdf.internal.pageSize.getWidth();
  const ph = pdf.internal.pageSize.getHeight();

  // Ajouter l'image du document captur√©
  pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, pw, ph);

  // Ajouter la mention LesFacilitateurs en bas
  pdf.setFontSize(8);
  pdf.text("¬© LesFacilitateurs Groupe - WhatsApp 651475255", 4, ph - 4);

  // Retirer le clone temporaire du DOM
  temp.remove();

  // T√©l√©charger le PDF
  pdf.save(docName + ".pdf");
}
</script>
</body>
</html>